<!DOCTYPE html>

<html>
  <head>
    <title>Practical JavaScript</title>
  </head>
  <body>
    <div>

      
      <h1>Todo List</h1>
      <div>
        <button onclick="handlers.toggleAll()">Toggle All</button>
      </div>

      <div>
        <button id="addTodoButton" onclick="handlers.addTodo()">Add Todo</button>
        <input id="addTodoTextInput" type="text">
      </div>

      <!-- <div>
        <button onclick="handlers.changeTodo()">Change Todo</button>
        <input id="position" type="number" placeholder="which todo position">
        <input id="changeTodoTextInput"  type="text" size="35" placeholder="what should the todo be changed to?">
      </div> -->

      <div id="listDiv" style="display:none; background-color: lightblue;">
        <div>
          <ul>

          </ul>
        </div>
        <div id="submitEditTodoDiv" style="display:none;">
          <button id="submitEditTodoButton">Submit Edit</button>
          <input id="submitEditTodoTextInput" type="text" size="35" placeholder="Type Edit Here">
        </div>
      </div>
      

    </div>
    <script>   
    var indexInt;
      var todoList = {
        
        todos:[],
        addTodos: function(todo){
          this.todos.push({
            todoText: todo,
            completed: false
          });
          var listDiv = document.getElementById('listDiv');
          if(listDiv.style.display === 'none'){
            listDiv.style.display = 'inline-block'
          }
          view.displayTodos();
        },
        changeTodos:function(position,newTodoText){
          oldValue = this.todos[position].todoText;
          this.todos[position].todoText = newTodoText;
          view.displayTodos();
        },
        deleteTodos:function(startPosition){
          this.todos.splice(startPosition,1);
          view.displayTodos();
        },
        toggleCompleted:function(todoPosition){
          if(this.todos[todoPosition].completed === true){
            this.todos[todoPosition].completed = false;
          }
          else{
            this.todos[todoPosition].completed = true;
          }
          
          view.displayTodos();
        },
        toggleAll:function(){
            var arrayLength = this.todos.length;
            var todosCompleted = 0;
            this.todos.forEach(element => {
              if(element.completed === true){
                todosCompleted++;
              }
            });
            if(todosCompleted === arrayLength){
              this.todos.forEach(element => {
                element.completed = false;
              });
            }
            else{
              this.todos.forEach(element => {
                element.completed = true;
              });
            }
            view.displayTodos();
        }
      };

      var handlers ={
        addTodo: function(){
          var addTodoTextInput = document.getElementById("addTodoTextInput");
          todoList.addTodos(addTodoTextInput.value);
          addTodoTextInput.value='';
        },
        changeTodo: function(){
          try{
            var position = document.getElementById("position");
            var changeTodoTextInput = document.getElementById("changeTodoTextInput");
            todoList.changeTodos(position.valueAsNumber, changeTodoTextInput.value);
            position.value = '';
            changeTodoTextInput.value = '';
          }
          catch{
            position.value = '';
            changeTodoTextInput.value = '';
          }
        },
        toggleAll: function(){
          todoList.toggleAll();
        }
      }

      var view ={
        displayTodos: function(){
          var todosUl = document.querySelector('ul');
          todosUl.innerHTML = '';
          todoList.todos.forEach((element, index) => {
            var todoLi = document.createElement('li');

            var completedText;
            var listItemString;
            if(element.completed == true){
              completedText = '(x)';
            }
            else{
              completedText = '( )';
            }
            listItemString = (completedText + ' ' + element.todoText);

            todoLi.id = index;
            todoLi.textContent = listItemString;
            todoLi.appendChild(createButtons.EditTodoTextButton());
            todoLi.appendChild(createButtons.changeStatusButton());
            todoLi.appendChild(createButtons.deleteButton());
            todosUl.appendChild(todoLi);
          });
        },
        setUpEventListeners: function(){
          //keyup evet listeners 
          var addTodoTextInput = document.getElementById('addTodoTextInput');
          addTodoTextInput.addEventListener('keyup', function(event){
            if(event.keyCode ===13){
              document.getElementById('addTodoButton').click();
              addTodoTextInput.value = '';
            }
          });

          //click event listeners          
          var submitEditTodoButton = document.getElementById('submitEditTodoButton');
          submitEditTodoButton.addEventListener('click', function(){
            var submitEditTextBox = document.getElementById('submitEditTodoTextInput');
            var SubmitEditTextBoxValue = submitEditTextBox.value;
          });

          //click event listeners inside of ul
          var todosUl = document.querySelector('ul');
          todosUl.addEventListener('click', function(event){
            var elementClicked = event.target;
            if(elementClicked.className === 'deleteButton'){
              todoList.deleteTodos(parseInt(elementClicked.parentNode.id))
            }
            if(elementClicked.className === 'changeStatusButton'){
              todoList.toggleCompleted(elementClicked.parentNode.id);
            }
            if(elementClicked.className === 'editTodoButton'){
              var hiddenDiv = document.getElementById('submitEditTodoDiv');
              //if hidden div is already displayed and the same edit button is pressed
              if(hiddenDiv.style.display === 'block' && indexInt === parseInt(elementClicked.parentNode.id)){
                hiddenDiv.style.display = 'none';
                indexInt = undefined;
                console.log(indexInt);
              }
              //if hidden div is already displayed but diffrent edit button is pressed
              else if(hiddenDiv.style.display === 'block'){
                indexInt = parseInt(elementClicked.parentNode.id);
                console.log(indexInt);
              }
              //if the hidden div is not displayed when the edit button is pressed
              else{
                hiddenDiv.style.display = 'block';
                indexInt = parseInt(elementClicked.parentNode.id);
                console.log(indexInt);
                }
            }
          });
        }
      }

      var createButtons ={
        deleteButton: function(){
          var deleteButton = document.createElement('button');
          deleteButton.textContent = 'delete';
          deleteButton.className = 'deleteButton';
          return deleteButton;
        },
        changeStatusButton: function(completion){
          var completeTodoButton = document.createElement('button');
          completeTodoButton.textContent = 'changeStatus';
          completeTodoButton.className = 'changeStatusButton'
          return completeTodoButton;
        },
        EditTodoTextButton: function(){
          var changeTodoButton = document.createElement('button');
          changeTodoButton.textContent = 'editTodo';
          changeTodoButton.className = 'editTodoButton';
          return changeTodoButton;
        }

      }

      view.setUpEventListeners();
    </script>
  </body>
</html>